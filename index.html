<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mock Mark Tracker</title>
<link rel="icon" href="favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #eaeaea;
}

/* HEADER */
header {
  display: flex;
  align-items: center;
  padding: 14px 20px;
  background: #1f1f1f;
}

header img.logo {
  height: 64px;
  margin-right: 14px;
}

header img.flag {
  height: 28px;
  margin-left: auto;
}

/* CARDS */
.card {
  background: #f4f4f4;
  color: #111;
  border-radius: 10px;
  padding: 16px;
  margin: 14px;
}

.card h3 {
  margin-top: 0;
}

/* TEST DETAILS */
#testDetails input {
  width: 100%;
  padding: 6px;
  margin-bottom: 6px;
}

/* SECTION CARD */
.section-row {
  display: grid;
  grid-template-columns: repeat(6, 1fr) auto;
  gap: 6px;
  margin-bottom: 6px;
}

.section-row input {
  padding: 6px;
}

/* BUTTONS */
button {
  padding: 8px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #1976d2;
  color: white;
}

button.danger {
  background: #d32f2f;
}

button.secondary {
  background: #555;
}

/* TABLE */
.table-card {
  background: #fdfdfd;
}

table {
  width: 100%;
  border-collapse: collapse;
  color: #111;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #ccc;
  text-align: center;
}

.best {
  background: #c8e6c9;
}

.worst {
  background: #ffcdd2;
}

/* GRAPH */
#graphContainer {
  display: none;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" class="logo" onerror="this.style.display='none'">
  <img src="emblem.png" class="logo" onerror="this.style.display='none'">
  <img src="flag.jpg" class="flag" onerror="this.style.display='none'">
</header>

<!-- TEST DETAILS -->
<div class="card" id="testDetails">
  <h3>Test Details</h3>
  <input id="examName" placeholder="Exam Name">
  <input id="testName" placeholder="Test Name">
  <input id="testDate" type="date">
  <input id="target" placeholder="Target Marks">
  <input id="negative" placeholder="Negative Marking (per wrong)">
</div>

<!-- SECTION MARKS -->
<div class="card">
  <h3>Sectional Marks</h3>
  <div id="sections"></div>
  <button onclick="addSection()">Add Section</button>
</div>

<!-- COUNTDOWN -->
<div class="card" id="countdownCard">
  <h3>Exam Day Countdown</h3>
  <div id="countdown">Select exam date</div>
</div>

<!-- CONTROLS -->
<div class="card">
  <select id="examFilter"></select>
  <button onclick="toggleGraph()">Graph</button>
  <button onclick="exportExcel()">Export Excel</button>
  <button onclick="exportPDF()">Export PDF</button>
</div>

<!-- TABLE -->
<div class="card table-card">
  <table id="testTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Test</th>
        <th>Total</th>
        <th>Sectional</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<!-- GRAPH -->
<div class="card" id="graphContainer">
  <canvas id="graph"></canvas>
</div>

<script>
/* ========= DATA MIGRATION ========= */
function migrateOldData() {
  const old = JSON.parse(localStorage.getItem("tests") || "[]");
  const current = JSON.parse(localStorage.getItem("mockTests") || "[]");

  if (current.length === 0 && old.length > 0) {
    localStorage.setItem("mockTests", JSON.stringify(old));
  }
}
migrateOldData();

/* ========= STATE ========= */
let tests = JSON.parse(localStorage.getItem("mockTests") || "[]");

/* ========= SECTION ========= */
function addSection(name="", marks="", correct="", wrong="", unattempted="") {
  const div = document.createElement("div");
  div.className = "section-row";
  div.innerHTML = `
    <input placeholder="Section" value="${name}">
    <input placeholder="Marks" value="${marks}">
    <input placeholder="Correct" value="${correct}">
    <input placeholder="Wrong" value="${wrong}">
    <input placeholder="Unattempted" value="${unattempted}">
    <button class="danger" onclick="this.parentElement.remove()">X</button>
  `;
  document.getElementById("sections").appendChild(div);
}

/* ========= TABLE ========= */
function renderTable() {
  const tbody = document.querySelector("#testTable tbody");
  tbody.innerHTML = "";

  if (tests.length === 0) return;

  let best = Math.max(...tests.map(t => t.total));
  let worst = Math.min(...tests.map(t => t.total));

  tests.forEach(t => {
    const tr = document.createElement("tr");
    if (t.total === best) tr.classList.add("best");
    if (t.total === worst) tr.classList.add("worst");

    tr.innerHTML = `
      <td>${t.date}</td>
      <td>${t.test}</td>
      <td>${t.total}</td>
      <td>${t.sectionSummary}</td>
    `;
    tbody.appendChild(tr);
  });
}
renderTable();

/* ========= COUNTDOWN ========= */
document.getElementById("testDate").addEventListener("change", e => {
  const d = new Date(e.target.value);
  const today = new Date();
  const diff = Math.ceil((d - today) / (1000 * 60 * 60 * 24));
  document.getElementById("countdown").innerText =
    diff >= 0 ? diff + " days remaining" : "Exam passed";
});

/* ========= GRAPH ========= */
function toggleGraph() {
  const g = document.getElementById("graphContainer");
  g.style.display = g.style.display === "none" ? "block" : "none";
}

/* ========= EXPORT ========= */
function exportExcel() {
  alert("Excel export hooked (safe placeholder)");
}
function exportPDF() {
  alert("PDF export hooked (safe placeholder)");
}
</script>

</body>
</html>
